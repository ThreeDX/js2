!function(){"use strict";function t(t,e,i,s){if(t=t||"board",e=e||8,i=i||8,s=s||!1,"string"==typeof t){if(this._wrapper=document.getElementById(t),!this._wrapper)throw new Error("Элемент "+t+" не найден!")}else this._wrapper=t;this._cellSize=50,this._lines=e,this._columns=i,this._drawLegend=s,this._letters="ABCDEFGHIJKLMNOPQRSTUVWXYZ",this._lastActive=null,this._rendered=!1,this._wrapper.addEventListener("click",function(t){if(t.target.classList.contains("ch-item")){var e=this._lastActive;this._lastActive&&this._lastActive.classList.remove("ch-active"),this._lastActive!=t.target?(t.target.classList.add("ch-active"),this._lastActive=t.target):this._lastActive=null,this.triggerEvent("activeCell",{oldCell:e,newCell:this._lastActive})}}.bind(this))}t.prototype.triggerEvent=function(t,e,i){i=i||this._wrapper,i.dispatchEvent(new CustomEvent(t,{detail:e,bubbles:!0,cancelable:!1}))},t.prototype.setCellSize=function(t){t=t||50,this._cellSize=t,this._rendered&&this.render()},t.prototype.setDimensions=function(t,e){t=t||8,e=e||8,this._lines=t,this._columns=e,this._rendered&&this.render()},t.prototype.showLegend=function(t){t=t||!1,this._drawLegend=t,this._rendered&&this.render()},t.prototype.render=function(){for(this._rendered=!0;this._wrapper.firstChild;)this._wrapper.removeChild(this._wrapper.firstChild);this._lastActive=null,this._wrapper.classList.toggle("ch-wrap",!0),this._wrapper.style.width=this._columns*this._cellSize+"px",this._wrapper.style.height=this._lines*this._cellSize+"px";for(var t=this._lines;t>0;t--){for(var e=0;e<this._columns;e++){var i=document.createElement("div"),s=this._letters[e%this._letters.length];if(e>=this._letters.length?(s+=Math.floor(e/this._letters.length),i.setAttribute("id",s+"-"+t)):i.setAttribute("id",s+t),this._wrapper.appendChild(i),i.style.width=this._cellSize+"px",i.style.height=this._cellSize+"px",i.style.lineHeight=this._cellSize+"px",i.style.fontSize=Math.floor(this._cellSize/1.5)+"px",i.classList.add("ch-item"),(t+e)%2&&i.classList.add("ch-black"),this.triggerEvent("renderCell",{Cell:i}),this._drawLegend&&1==t){var r=document.createElement("div");this._wrapper.appendChild(r),r.innerHTML=s,r.classList.add("ch-label"),r.style.top=this._lines*this._cellSize+1+"px",r.style.left=e*this._cellSize+"px",r.style.width=this._cellSize+"px",r.style.height=this._cellSize+"px",r.style.lineHeight=this._cellSize+"px",r.style.fontSize=Math.floor(this._cellSize/2)+"px"}}if(this._drawLegend){var l=document.createElement("div");this._wrapper.appendChild(l),l.classList.add("ch-label"),l.innerHTML=t.toString(),l.style.top=(this._lines-t)*this._cellSize+"px",l.style.left=this._columns*this._cellSize+1+"px",l.style.width=this._cellSize+"px",l.style.height=this._cellSize+"px",l.style.lineHeight=this._cellSize+"px",l.style.fontSize=Math.floor(this._cellSize/2)+"px"}}},t.prototype.addEventListener=function(t,e){return this._wrapper.addEventListener(t,e)},window.Board=t}(),function(){"use strict";function t(t){Board.call(this,t,8,8,!0),this._loaded=!1,this._figures={},this.addEventListener("activeCell",function(t){t.detail.oldCell&&(console.log("Cell "+t.detail.oldCell.id+" deactivated"),this.removeFigure(t.detail.oldCell.id)),t.detail.newCell&&(console.log("Cell "+t.detail.newCell.id+" activated"),this.removeFigure(t.detail.newCell.id))}.bind(this)),this.addEventListener("renderCell",function(t){this._loaded&&this._figures.hasOwnProperty(t.detail.Cell.id)&&this._figures[t.detail.Cell.id].render(t.detail.Cell)}.bind(this))}t.prototype=Object.create(Board.prototype),t.prototype.constructor=t,t.prototype.activeCell=function(t){if(!this._rendered)return null;if(!t&&this._lastActive)return this._lastActive.id;if("string"==typeof t&&/^[A-H][1-8]$/.test(t)){var e=document.getElementById(t);if(!e)return!1;var i=this._lastActive;return this._lastActive&&this._lastActive.classList.remove("ch-active"),this._lastActive!=e?(e.classList.add("ch-active"),this._lastActive=e):this._lastActive=null,this.triggerEvent("activeCell",{oldCell:i,newCell:this._lastActive}),!0}return null},t.prototype.init=function(t){this._clearFigures();var e=new XMLHttpRequest;e.open("GET",t,!0),e.send(),e.onreadystatechange=function(){if(e.readyState===XMLHttpRequest.DONE&&200===e.status)try{this._setFigures(JSON.parse(e.responseText))}catch(t){console.log("Ошибка инициализации фигурами: "+t)}}.bind(this)},t.prototype._setFigures=function(t){for(var e=0;e<t.length;e++){if(!/^[A-H][1-8]$/.test(t[e].cell))throw"Неверная ячейка: "+t[e].cell;if(this._figures.hasOwnProperty(t[e].cell))throw"Несколько фигур в ячейке "+t[e].cell;switch(t[e].figure){case"Figure":case"FigureCastle":case"FigureKnight":case"FigureBishop":case"FigureQueen":case"FigureKing":var i=window[t[e].figure];this._figures[t[e].cell]=new i(t[e].cell,"white"==t[e].color);break;default:throw"Неизвестный тип фигуры: "+t[e].figure}}this._loaded=!0,this._rendered&&this.render()},t.prototype._clearFigures=function(){this._loaded&&(this._loaded=!1,this._figures={},this._rendered&&this.render())},t.prototype.removeFigure=function(t){if(!this._loaded)return!1;if(!this._figures.hasOwnProperty(t))return!1;if(this._figures[t]=void 0,this._rendered){var e=document.getElementById(t);e.innerHTML=""}},t.prototype.setDimensions=function(){},t.prototype.showLegend=function(){},window.ChessBoard=t}(),function(){"use strict";function t(t,e){this._isWhite=e,this._position=t,this._fig=["♙","♟"]}function e(e,i){t.apply(this,arguments),this._fig=["♖","♜"]}function i(e,i){t.apply(this,arguments),this._fig=["♘","♞"]}function s(e,i){t.apply(this,arguments),this._fig=["♗","♝"]}function r(e,i){t.apply(this,arguments),this._fig=["♕","♛"]}function l(e,i){t.apply(this,arguments),this._fig=["♔","♚"]}t.prototype.getMoves=function(t){},t.prototype.getAttack=function(t){},t.prototype.canMove=function(t,e){},t.prototype.CanAttack=function(t,e){},t.prototype._setPosition=function(t){},t.prototype.render=function(t){t.innerHTML=this._isWhite?this._fig[0]:this._fig[1],t.classList.toggle("ch-shadow",!1),this._isWhite?(t.style.color="#DDD",t.classList.contains("ch-black")||t.classList.toggle("ch-shadow",!0)):(t.style.color="#222",t.classList.contains("ch-black")&&t.classList.toggle("ch-shadow",!0))},e.prototype=Object.create(t.prototype),e.prototype.constructor=e,i.prototype=Object.create(t.prototype),i.prototype.constructor=i,s.prototype=Object.create(t.prototype),s.prototype.constructor=s,r.prototype=Object.create(t.prototype),r.prototype.constructor=r,l.prototype=Object.create(t.prototype),l.prototype.constructor=l,window.Figure=t,window.FigureCastle=e,window.FigureKnight=i,window.FigureBishop=s,window.FigureQueen=r,window.FigureKing=l}();